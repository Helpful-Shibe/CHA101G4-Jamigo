<!DOCTYPE html>
<html class="no-js" lang="zxx">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>Jamigo - 活動介紹</title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    />
    <!-- Place favicon.ico in the root directory -->
    <!-- 引入 Axios 的 CDN -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <!-- CSS here -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    />
    <link rel="stylesheet" href="./detail/static/css/bootstrap.min.css" />
    <link rel="stylesheet" href="./detail/static/css/animate.min.css" />
    <link rel="stylesheet" href="./detail/static/css/magnific-popup.css" />
    <link rel="stylesheet" href="./detail/static/css/all.min.css" />

    <link rel="stylesheet" href="./detail/static/css/dripicons.css" />
    <link rel="stylesheet" href="./detail/static/css/slick.css" />
    <link rel="stylesheet" href="./detail/static/css/meanmenu.css" />
    <link rel="stylesheet" href="./detail/static/css/default.css" />
    <link rel="stylesheet" href="./detail/static/css/style.css" />
    <link rel="stylesheet" href="./detail/static/css/responsive.css" />

    <!-- 此線後為頁首頁尾區引用檔案(bootstrap) -->
    <link rel="stylesheet" href="./space/footer/css/bootstrap.css" />
    <!-- Font Awesome引用檔案 -->
    <link rel="stylesheet" href="./space/footer/css/all.css" />
    <!-- css本體，套用頁首頁尾 -->

    <link
      rel="stylesheet"
      type="text/css"
      href="/Jamigo/activity/space/assets/css/style.css"
    />
    <style>
      .btn1 {
        text-align: center;
      }

      .btn2 {
        text-align: right;
      }

      body {
        background-color: #f5f5f5;
      }

      .sidebar-widget {
        border: none;
        box-shadow: 0 0.5rem 1rem 0 rgba(0, 0, 0, 0.1);
      }

      .card-img-top {
        object-fit: cover;
        height: 300px;
        /* Adjust this value to change the height of the image */
      }

      .btn-primary {
        border: none;
        background: #01a5c0;
        color: #fff;
        width: 150px;
        /* Adjust this value to change the width of the button */
      }

      .btn-primary:hover {
        background: #008999;
      }

      .row {
        display: flex;
      }

      .col-lg-8,
      .col-lg-4 {
        display: flex;
        flex-direction: column;
      }

      .col-lg-8 > div,
      .col-lg-4 > div {
        flex-grow: 1;
      }

      .list-group-item {
        padding-bottom: 8px;
        /* Add a simple line to each item */
      }

      .list-group-item::after {
        content: "";
        display: block;
        border-bottom: 1px solid #ccc;
        /* 將這裡的顏色值設定為您想要的柔和顏色 */
        margin-top: 8px;
      }

      .date-wrapper {
        white-space: pre-wrap;
      }

      .date-wrapper div {
        text-decoration: underline;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  </head>

  <body>
    <nav class="navbar navbar-dark p-0 navbar-expand-lg">
      <div class="container">
        <a href="/Jamigo/index/首頁/index.html" class="navbar-brand"
          ><img
            src="/Jamigo/index/頁首頁尾_final/images/找百貨.png"
            alt=""
            class="LOGO"
        /></a>
        <img
          src="/Jamigo/index/頁首頁尾_final/images/頁首背景.gif"
          alt=""
          class="navbarimg"
        />
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarSupportedContent"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a
                class="button-01 nav-link"
                href="/Jamigo/index/首頁/index.html"
              >
                回首頁</a
              >
            </li>
            <li class="nav-item">
              <a
                class="button-01 nav-link"
                href="/Jamigo/shop/main_page/商城首頁.html"
                >線上商城</a
              >
            </li>
            <li class="nav-item">
              <a
                class="button-01 nav-link"
                href="/Jamigo/activity/event_space.html"
                >文藝活動</a
              >
            </li>
            <li class="nav-item">
              <a
                class="button-01 nav-link"
                href="/Jamigo/promotion/promotion_list/promotion_space.html"
                >折扣快報</a
              >
            </li>
            <!--                                <li class="nav-item"> -->
            <!--                                    <a class="button-01 nav-link" href="*">客服系統</a> -->
            <!--                                </li> -->
            <li class="nav-item">
              <a
                class="button-01 nav-link"
                href="/Jamigo/frontend/前台會員管理首頁.html"
                onclick="check(event);"
                >會員專區</a
              >
            </li>
          </ul>
        </div>
        <!--         導覽列右側 -->
        <div id="signin">
          <a href="/Jamigo/member/login/login.html">
            <button class="login-button">
              <i class="nav-icon fa-regular fa-user" style="color: #f5f5f5"></i>
              會員登入/註冊
            </button>
          </a>
        </div>
        <div id="memberinfo">
          <div id="imgcontainer">
            <img src="#" alt="" id="memberimg" />
          </div>
          <div class="memberinfo_container" id="signininfo">
            <span id="membername">HI! </span>
            <button
              id="logoutbutton"
              class="logout-button"
              onclick="opensignin();"
            >
              登出
            </button>
          </div>
        </div>
      </div>
    </nav>
    <main class="main_before">
      <!-- breadcrumb-area -->
      <section
        class="breadcrumb-area d-flex align-items-center"
        style="
          background-image: url(./detail/img/bg/gv.jpg);
          background-size: cover;
          background-position: center;
          background-repeat: no-repeat;
        "
      >
        <div class="container">
          <div class="row align-items-center">
            <div class="col-xl-12 col-lg-12">
              <div class="breadcrumb-wrap text-left">
                <div class="breadcrumb-title">
                  <h2>活動介紹</h2>
                  <div class="breadcrumb-wrap">
                    <nav aria-label="breadcrumb">
                      <ol class="breadcrumb">
                        <li class="breadcrumb-item">
                          <a href="/Jamigo/index/首頁/index.html">回首頁</a>
                        </li>
                        <li class="breadcrumb-item active">
                          <a
                            href="/Jamigo/promotion/promotion_list/promotion_space.html"
                            >活動專區</a
                          >
                        </li>
                      </ol>
                    </nav>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
      <!-- breadcrumb-area-end -->
      <!-------------------------------------------- 頁首結束 ------------------------------>
      <!-- main-area -->
      <main>
        <main>
          <section class="project-detail">
            <div class="container mt-5">
              <div class="row h-100">
                <!-- 左邊的活動詳細信息 -->
                <div class="col-lg-8 d-flex">
                  <div class="card w-100">
                    <div class="card-body">
                      <img
                        id="promotion-pic"
                        class="img-fluid rounded mb-4"
                        alt="Activity picture"
                      />
                      <h5 id="activity-name" class="font-weight-bold mb-4"></h5>
                      <p id="activity-detail">活動內容:</p>
                      <!-- <button class="btn btn-primary btn-block mb-2"
                                                                        style="border-radius: 5px; background: #01a5c0;">我要報名</button>
                                                                    <button class="btn btn-primary btn-block"
                                                                        style="border-radius: 5px; background: #01a5c0;">收藏活動</button> -->
                    </div>
                  </div>
                </div>

                <!-- 右邊的活動資訊 -->
                <div class="col-lg-4 d-flex">
                  <aside class="sidebar-widget h-100">
                    <section class="widget widget_search">
                      <div class="course-widget-price">
                        <h2 class="widget-title">折價券活動</h2>
                      </div>
                      <ul class="list-group list-group-flush">
                        <!--
                                                                            <li class="list-group-item"><i class="fal fa-user"></i>
                                                                                <span>活動名稱</span> <span id="activity-name-info"
                                                                                class="float-right"></span></li> -->
                        <li class="list-group-item">
                          <i class="fal fa-calendar"></i>
                          <span>折價券活動名稱</span>
                          <span
                            id="promotion-coupon-name"
                            class="float-right"
                          ></span>
                        </li>
                        <li class="list-group-item">
                          <i class="fal fa-calendar"></i>
                          <span>活動類別名稱</span>
                          <span id="promotion-name" class="float-right"></span>
                        </li>
                        <li class="list-group-item">
                          <i class="fal fa-map-marker"></i
                          ><span> 會員等級限制</span>
                          <span
                            id="get-couponL-lmit-level"
                            class="float-right"
                          ></span>
                        </li>
                        <li class="list-group-item">
                          <i class="fal fa-map-marker"></i
                          ><span> 發放數量</span>
                          <span
                            id="amount-of-coupon"
                            class="float-right"
                          ></span>
                        </li>
                        <li class="list-group-item">
                          <i class="fal fa-map-marker"></i
                          ><span> 已領取數量</span>
                          <span id="get-amount" class="float-right"></span>
                        </li>
                        <li class="list-group-item">
                          <i class="fal fa-clock"></i>
                          <span> 活動生效日期</span>
                          <span
                            id="promotion-effective-date"
                            class="float-right"
                          ></span>
                        </li>
                        <li class="list-group-item">
                          <i class="fal fa-clock"></i>
                          <span> 活動結束日期</span>
                          <span
                            id="promotion-expire-date"
                            class="float-right"
                          ></span>
                        </li>
                        <li class="list-group-item">
                          <i class="fal fa-calendar"></i
                          ><span> 折價券種類名稱</span>
                          <span
                            id="coupon-type-name"
                            class="float-right"
                          ></span>
                        </li>
                        <li class="list-group-item">
                          <i class="fal fa-calendar"></i
                          ><span> 使用條件說明</span>
                          <span
                            id="coupon-conditions"
                            class="float-right"
                          ></span>
                        </li>
                        <li class="list-group-item">
                          <i class="fal fa-dollar-sign"></i
                          ><span> 折扣金額</span>
                          <span id="coupon-price" class="float-right"></span>
                        </li>
                        <li class="list-group-item">
                          <i class="fal fa-map-marker"></i
                          ><span> 失效日期</span>
                          <span
                            id="coupon-expire-date"
                            class="float-right"
                          ></span>
                        </li>
                        <div id="dhave">
                          <button
                            type="button"
                            class="btn btn-primary d-grid gap-2 col-6 mt-3 mx-auto"
                            id="newbutton"
                          >
                            立即領取
                          </button>
                        </div>

                        <div id="have" hidden>
                          <button
                            type="button"
                            class="btn btn-secondary d-grid gap-2 col-6 mt-3 mx-auto"
                          >
                            已領取
                          </button>
                        </div>
                      </ul>
                    </section>
                  </aside>
                </div>
              </div>
            </div>
          </section>
        </main>
        <!--End Project Detail -->
      </main>
      <!-- main-area-end -->
      <!------------------------------------ 頁尾開始 ----------------------------------->
    </main>
    <div class="footer_section bg-dark text-light">
      <div class="container_footer">
        <div class="row">
          <div class="col-lg-2 col-sm-6 col-xs-12">
            <h1 class="customer_text">合作資訊</h1>
            <div class="footer_lorem_text">
              <p>
                <a href="count_apply.html">櫃位申請</a>
              </p>
              <p>
                <a href="site_info.html">場地相關</a>
              </p>
              <p>
                <a href="talents_recruit.html">人才招募</a>
              </p>
            </div>
          </div>
          <div class="col-lg-2 col-sm-6 col-xs-12">
            <h1 class="customer_text">關於我們</h1>
            <div class="footer_lorem_text">
              <p>
                <a href="shop_info.html">營業資訊</a>
              </p>
              <p>
                <a href="FAQ.html">FAQ中心</a>
              </p>
              <p>
                <a href="transpotation.html">交通資訊</a>
              </p>
            </div>
          </div>
          <div class="col-lg-2 col-sm-6 col-xs-12">
            <h1 class="customer_text">會員相關</h1>
            <div class="footer_lorem_text">
              <p>
                <a href="pay_info.html">付款方式</a>
              </p>
              <p>
                <a href="deliver_info.html">配送流程</a>
              </p>
              <p>
                <a href="return_product.html">退換商品</a>
              </p>
            </div>
          </div>
          <div class="col-lg-3 col-sm-6 col-xs-12">
            <h1 class="customer_text">聯絡我們</h1>
            <div class="footer_lorem_text">
              <p>JAMIGO 1234-5678 <br />桃園市中壢區復興路46號</p>
              <p>010-020-0340</p>
              <p>&copy;info@company.co</p>
            </div>
          </div>
          <div class="col-lg-3 col-sm-6 col-xs-12">
            <img
              src="./space/footer/images/footer_LOGO.png"
              alt=""
              class="footer_LOGO"
            />
          </div>
        </div>
      </div>
      <div class="footer_icon">
        <a href="#"><i class="footer-icon fa-brands fa-instagram fa-xl"></i></a>
        <a href="#"></a><i class="footer-icon fa-brands fa-facebook fa-xl"></i>
        <a href="#"></a
        ><i class="footer-icon fa-brands fa-square-twitter fa-xl"></i>
        <a href="#"></a><i class="footer-icon fa-brands fa-line fa-xl"></i>
      </div>
    </div>
    <!-------------------------------------  頁尾結束 ---------------------------------->
    <!-- JS here -->
    <script>
      //活動詳情
      // 定義一個格式化日期的函數
      function formatDate(dateString) {
        const date = new Date(dateString);
        const options = {
          year: "numeric",
          month: "long",
          day: "numeric",
          timeZone: "Asia/Taipei",
          locale: "zh-TW", //指定中文
        };
        return date.toLocaleString("zh-TW", options);
      }

      //當網頁加載完成後將會被執行的函數,async表示一個是非同步函數，它允許在函數中使用await來等待Promise完成
      window.onload = async function () {
        try {
          // 從URL中取出活動ID
          const urlParams = new URLSearchParams(window.location.search);
          //創建了一個 URLSearchParams 物件，該物件可以讓你操作 URL 的查詢字符串參數。
          const promotionCouponNo = urlParams.get("promotionCouponNo"); //用於從查詢字符串中提取名為activityId的參數
          // 向後端服務器請求活動數據
          const response = await axios.get(
            `/Jamigo/coupons/${promotionCouponNo}`
          );
          const pc = response.data;

          // 向後端服務器請求活動數據
          // 使用活動數據來更新你的頁面
          document.querySelector(
            "#promotion-pic"
          ).src = `data:image/jpeg;base64,${pc.promotionPic}`;
          document.querySelector("#promotion-coupon-name").innerText =
            pc.promotionCouponName;
          document.querySelector("#promotion-name").innerText =
            pc.promotionName;
          document.querySelector("#get-couponL-lmit-level").innerText =
            pc.getCouponLimitLevel;
          document.querySelector("#amount-of-coupon").innerText =
            pc.amountOfCoupon;
          document.querySelector("#get-amount").innerText = pc.getAmount;
          document.getElementById(
            "promotion-effective-date"
          ).innerHTML = `<div class="date-wrapper">${formatDate(
            pc.promotionEffectiveDate
          )}</div>`;
          document.getElementById(
            "promotion-expire-date"
          ).innerHTML = `<div class="date-wrapper">${formatDate(
            pc.promotionExpireDate
          )}</div>`;
          let couponTypeNo = pc.couponTypeNo;
          getCouponType(couponTypeNo);
        } catch (error) {
          // 如果在獲取數據過程中發生錯誤，則打印錯誤信息到控制台
          console.error(error);
          console.log("failed!");
        }

        async function getCouponType(couponTypeNo) {
          try {
            const response = await axios.get(
              `/Jamigo/coupontype/${couponTypeNo}`
            );
            const pt = response.data;

            document.querySelector("#coupon-type-name").innerText =
              pt.couponTypeName;
            document.querySelector("#coupon-conditions").innerText =
              pt.couponConditions;
            document.querySelector("#coupon-price").innerText = pt.couponPrice;

            document.getElementById(
              "coupon-expire-date"
            ).innerHTML = `<div class="date-wrapper">${formatDate(
              pt.couponExpireDate
            )}</div>`;
          } catch (error) {
            console.error(error);
            console.log("failed!");
          }
        }
      };
      (() => {
        const memberNoa = localStorage.getItem("memberNo");
        const newbutton = document.querySelector("#newbutton");
        var divh = document.getElementById("have");
        var divd = document.getElementById("dhave");

        const urlParams = new URLSearchParams(window.location.search);
        //創建了一個 URLSearchParams 物件，該物件可以讓你操作 URL 的查詢字符串參數。
        const promotionCouponNo = urlParams.get("promotionCouponNo"); //用於從查詢字符串中提取名為activityId的參數
        // 向後端服務器請求活動數據
        console.log(
          "memberNoa" + memberNoa + "promotionCouponNo" + promotionCouponNo
        );

        function getCoupon(memberNoa, promotionCouponNo) {
          fetch("newMemberCoupon", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              memberNo: memberNoa,
              promotionCouponNo: promotionCouponNo,
            }),
          })
            .then((resp) => resp.json())
            .then((body) => {
              console.log(body);
              const { successful, message } = body;
              if (successful) {
                Swal.fire({
                  position: "center",
                  icon: "success",
                  title: "成功取得折價券!",
                  showConfirmButton: false,
                  timer: 1500,
                })
                  .then(() => {
                    divh.removeAttribute("hidden");
                    divd.setAttribute("hidden", true);
                  })
                  .then(() => {
                    location.reload();
                  });
              } else {
                Swal.fire({
                  icon: "error",
                  title: "Oops...",
                  text: `${message}`,
                  footer: '<a href=""></a>',
                });
              }
            });
        }

        newbutton.addEventListener("click", () => {
          getCoupon(memberNoa, promotionCouponNo);
        });
      })();
    </script>

    <!-------------------------------------  登入調版 ---------------------------------->
    <script>
      var session = localStorage.getItem("memberNo");
      if (session) {
        var button = document.querySelector(".login-button");
        button.hidden = true;
      } else {
        console.log("安安沒事，沒跑版");
      }
    </script>

    <script src="./detail/static/js/modernizr-3.5.0.min.js"></script>
    <script src="./detail/static/js/jquery-3.6.0.min.js"></script>
    <script src="./detail/static/js/popper.min.js"></script>
    <script src="./detail/static/js/bootstrap.min.js"></script>
    <script src="./detail/static/js/slick.min.js"></script>
    <script src="./detail/static/js/ajax-form.js"></script>
    <script src="./detail/static/js/paroller.js"></script>
    <script src="./detail/static/js/wow.min.js"></script>
    <script src="./detail/static/js/js_isotope.pkgd.min.js"></script>
    <script src="./detail/static/js/imagesloaded.min.js"></script>
    <script src="./detail/static/js/parallax.min.js"></script>
    <script src="./detail/static/js/jquery.waypoints.min.js"></script>
    <script src="#"></script>
    <script src="./detail/static/js/jquery.scrollUp.min.js"></script>
    <script src="./detail/static/js/jquery.meanmenu.min.js"></script>
    <script src="./detail/static/js/parallax-scroll.js"></script>
    <script src="./detail/static/js/jquery.magnific-popup.min.js"></script>
    <script src="./detail/static/js/element-in-view.js"></script>
    <script src="./detail/static/js/main.js"></script>

    <!-- 頁首頁尾JS引用區 -->
    <script src="./space/footer/js/bootstrap.js"></script>
    <!-- FontAwesome -->
    <script src="./space/footer/js/all.js"></script>
    <!-- js -->
<!--    <script src="/Jamigo/index/頁首頁尾_final/js/script.js"></script>-->

    <script src="/Jamigo/frontEnd/js/script.js"></script>
  </body>
</html>
